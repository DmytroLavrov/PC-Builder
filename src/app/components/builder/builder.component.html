<div class="container">
  <app-builds-manager />

  <div class="header-section">
    <h1>Ultimate PC Builder</h1>
    <p>Build your dream PC with automatic compatibility check</p>
  </div>

  <div class="layout">
    <div class="parts-list">
      @for (cat of categories; track cat.key) {
        <div class="category-section">
          <div class="cat-header">
            <h2>{{ cat.label }}</h2>
          </div>

          <div class="cat-content">
            @if (builderService.build()[cat.key]; as selected) {
              <div class="selected-view">
                <img
                  [src]="selected.image || defaultImage"
                  (error)="handleMissingImage($event)"
                  [alt]="selected.name"
                />
                <div class="info">
                  <strong>{{ selected.name }}</strong>
                  <span>${{ selected.price }}</span>
                </div>
                <button
                  class="btn-remove"
                  (click)="builderService.removeProduct(cat.key)"
                  title="Delete"
                >
                  ‚úï
                </button>
              </div>
            } @else {
              <div class="products-grid">
                @for (product of getProductsByCategory(cat.key); track product.id) {
                  <div class="product-card" (click)="selectProduct(cat.key, product)">
                    <div class="img-wrapper">
                      <img
                        [src]="product.image || defaultImage"
                        (error)="handleMissingImage($event)"
                        [alt]="product.name"
                        loading="lazy"
                      />
                    </div>

                    <h3>{{ product.name }}</h3>

                    <div class="specs">
                      {{
                        product.specs.socket ||
                          product.specs.memoryType ||
                          product.specs.wattage + 'W'
                      }}
                    </div>

                    <div class="price">${{ product.price }}</div>
                  </div>
                }
                @if (getProductsByCategory(cat.key).length === 0) {
                  <div class="empty-filter">
                    There are no compatible components for your build. Try changing your processor
                    or motherboard.
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }
    </div>

    <aside class="summary-panel">
      <div class="sticky-wrapper">
        <div class="summary-card">
          <h2>Summary</h2>

          <div class="stat-row">
            <span>Power Draw</span>
            <span>{{ builderService.totalWattage() }}W</span>
          </div>

          <div class="stat-row">
            <span>Items</span>
            <span>{{ builderService.selectedItemsCount() }} / 7 pcs</span>
          </div>

          <div class="stat-row total">
            <span>Total</span>
            <span>${{ builderService.totalPrice() }}</span>
          </div>

          <button class="btn-checkout">üõí Buy Build</button>

          @if (builderService.compatibilityIssues().length > 0) {
            <div class="issues-list">
              @for (issue of builderService.compatibilityIssues(); track issue) {
                <div class="issue-item">‚ö†Ô∏è {{ issue }}</div>
              }
            </div>
          } @else {
            @if (builderService.totalPrice() > 0) {
              <div class="status-ok">‚úÖ Fully Compatible</div>
            }
          }
        </div>
      </div>
    </aside>
  </div>
</div>
