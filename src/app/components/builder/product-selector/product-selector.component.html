<div class="modal-backdrop" (click)="close.emit()">
  <div class="modal-window" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Select {{ categoryLabel }}</h3>
      <button class="btn-close-modal" (click)="close.emit()">✕</button>
    </div>

    <div class="controls-bar">
      <div class="stats">
        <span class="count-badge">{{ products.length }} loaded</span>
        <span class="total-text">of {{ totalCount }} total</span>
      </div>

      <div class="search-wrapper">
        <input
          #searchInput
          type="text"
          placeholder="Search components..."
          (input)="onSearch($event)"
        />
        @if (searchInput.value) {
          <button class="btn-clear" (click)="clearSearch(searchInput)">✕</button>
        }
      </div>

      <div class="sort-wrapper">
        <select id="sort" (change)="onSortChange($event)">
          <option value="default">Default</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name">Name (A-Z)</option>
        </select>
      </div>
    </div>

    <div class="modal-body">
      <div class="products-grid">
        @for (product of products; track product.id) {
          <div class="product-card" (click)="select.emit(product)">
            <div class="img-wrapper">
              <img
                [src]="product.image || defaultImage"
                (error)="handleMissingImage($event)"
                [alt]="product.name"
                loading="lazy"
              />
            </div>
            <h3>{{ product.name }}</h3>
            <div class="specs">
              {{
                product.specs.socket ||
                  product.specs.memoryType ||
                  (product.specs.wattage ? product.specs.wattage + 'W' : '')
              }}
            </div>
            <div class="price">${{ product.price }}</div>
          </div>
        }

        @if (isLoading) {
          @for (item of skeletonItems; track $index) {
            <div class="product-card skeleton">
              <div class="sk-img"></div>
              <div class="sk-title"></div>
              <div class="sk-specs"></div>
              <div class="sk-price"></div>
            </div>
          }
        }

        @if (products.length === 0 && !isLoading) {
          <div class="empty-filter">No components found.</div>
        }
      </div>

      @if (products.length < totalCount && !isLoading) {
        <div class="load-more-container">
          <div class="load-info">Showing {{ products.length }} of {{ totalCount }}</div>
          <button class="btn-load-more" (click)="loadMore.emit()">Load More from Server</button>
        </div>
      }
    </div>
  </div>
</div>
