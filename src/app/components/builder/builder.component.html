<div class="container">
  <app-builds-manager />

  <div class="header-section">
    <h1>Ultimate PC Builder</h1>
    <p>Build your dream PC with automatic compatibility check</p>
  </div>

  <div class="layout">
    <div class="parts-list">
      @for (cat of categories; track cat.key) {
        <div class="category-section">
          <div class="cat-header">
            <h2>{{ cat.label }}</h2>
          </div>

          <div class="cat-content">
            @if (builderService.build()[cat.key]; as selected) {
              <div class="selected-view">
                <img
                  [src]="selected.image || defaultImage"
                  (error)="handleMissingImage($event)"
                  [alt]="selected.name"
                />
                <div class="info">
                  <strong>{{ selected.name }}</strong>
                  <span>${{ selected.price }}</span>
                </div>
                <button
                  class="btn-remove"
                  (click)="builderService.removeProduct(cat.key)"
                  title="Remove"
                >
                  ‚úï
                </button>
              </div>
            } @else {
              <div class="empty-slot" (click)="openCategory(cat.key)">
                <div class="left-content">
                  <div class="placeholder-icon">+</div>
                  <div class="placeholder-text">Add {{ cat.label }}</div>
                </div>
                <button class="btn-add">Select</button>
              </div>
            }
          </div>
        </div>
      }
    </div>

    <aside class="summary-panel">
      <div class="sticky-wrapper">
        <div class="summary-card">
          <h2>Summary</h2>
          <div class="stat-row">
            <span>Power Draw</span>
            <span>{{ builderService.totalWattage() }}W</span>
          </div>
          <div class="stat-row">
            <span>Items</span>
            <span>{{ builderService.selectedItemsCount() }} / 7 pcs</span>
          </div>
          <div class="stat-row total">
            <span>Total</span>
            <span>${{ builderService.totalPrice() }}</span>
          </div>
          <button class="btn-checkout">üõí Buy Build</button>
          @if (builderService.compatibilityIssues().length > 0) {
            <div class="issues-list">
              @for (issue of builderService.compatibilityIssues(); track issue) {
                <div class="issue-item">‚ö†Ô∏è {{ issue }}</div>
              }
            </div>
          } @else {
            @if (builderService.totalPrice() > 0) {
              <div class="status-ok">‚úÖ Fully Compatible</div>
            }
          }
        </div>
      </div>
    </aside>
  </div>
</div>

@if (activeCategory(); as activeKey) {
  <app-product-selector
    [categoryLabel]="activeCategoryLabel()"
    [products]="getProductsByCategory(activeKey)"
    [totalCount]="getTotalCountByCategory(activeKey)"
    (select)="selectProduct(activeKey, $event)"
    (close)="closeCategory()"
  />
}
