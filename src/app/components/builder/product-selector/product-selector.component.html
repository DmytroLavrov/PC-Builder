<div class="modal-backdrop" (click)="close.emit()">
  <div class="modal-window" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Select {{ categoryLabel }}</h3>
      <button class="btn-close-modal" (click)="close.emit()">✕</button>
    </div>

    <div class="controls-bar">
      <div class="stats">
        <span class="count-badge">{{ displayedProducts.length }} compatible</span>
        <span class="total-text">from {{ totalCount }} total</span>
      </div>

      <div class="search-wrapper">
        <input
          type="text"
          placeholder="Search components..."
          [value]="searchQuery()"
          (input)="onSearch($event)"
        />
        @if (searchQuery()) {
          <button class="btn-clear" (click)="searchQuery.set('')">✕</button>
        }
      </div>

      <div class="sort-wrapper">
        <select id="sort" (change)="onSortChange($event)" [value]="currentSort()">
          <option value="default">Default</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name">Name (A-Z)</option>
        </select>
      </div>
    </div>

    <div class="modal-body">
      <div class="products-grid">
        @for (product of displayedProducts; track product.id) {
          <div class="product-card" (click)="select.emit(product)">
            <div class="img-wrapper">
              <img
                [src]="product.image || defaultImage"
                (error)="handleMissingImage($event)"
                [alt]="product.name"
                loading="lazy"
              />
            </div>
            <h3>{{ product.name }}</h3>
            <div class="specs">
              {{
                product.specs.socket ||
                  product.specs.memoryType ||
                  (product.specs.wattage ? product.specs.wattage + 'W' : '')
              }}
            </div>
            <div class="price">${{ product.price }}</div>
          </div>
        }

        @if (displayedProducts.length === 0) {
          <div class="empty-filter">
            @if (searchQuery()) {
              No results found for "{{ searchQuery() }}"
            } @else {
              No compatible components found.
            }
          </div>
        }
      </div>
    </div>
  </div>
</div>
